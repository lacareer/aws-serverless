# Herein are the instructions for this module 

# https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-reference.html

<!-- Module goals -->
Learn how to deploy a serverless application manually with the SAM CLI
Understand the artifacts generated by a SAM build
Explore the CloudFormation stack created by the SAM deployment

<!-- Read Notes and move to building the app-->
Artifacts refer to the output of your build process in the context of CI/CD. Artifacts are typically in the form of a zip/tar file, container image, or a binary, for example. You take these artifacts and deploy them onto your different environments (i.e. Dev, Test, Prod). For serverless projects, zip artifacts must be uploaded to an S3 bucket for the Lambda service to pick them up. The SAM CLI takes care of managing this process of uploading artifacts to S3 and referencing them at deployment time.

The Zip file
The first artifact that gets generated in a serverless project is your application code and supporting libraries. By default, these are compressed in a zip file and uploaded to an S3 bucket by the SAM CLI during the package phase (more on this later)

The Packaged Template
The second artifact that SAM CLI generates during the package phase is the packaged template. Which is a copy of your project's template.yaml, except that it references the location of the zip file (first artifact) in the S3 bucket. The following image shows an example of a packaged template.

<!-- Build the SAM app -->
cd ~/PATH_TO/sam-app
sam build

    When the build finishes successfully, you will see a new directory created in the root of the project named .aws-sam 
    Take a moment to explore the content of the build folder. Notice that the unit tests are automatically excluded and 3rd party dependencies are included. SAM takes care of this for us.

<!-- Deploy the SAM app -->
    
    The sam deploy command deploys your application by launching a CloudFormation stack. This command has a guided interactive mode, which you enable by specifying the --guided parameter. It is recommended to deploy with guided mode for the first time as it will capture the configuration for future deployments in a new file samconfig.toml described at the end of this section.
    
    This will walk you through a series of questions. Your answers will be saved to the configuration file at the end which will speed up future deployments. Pressing the Enter key will accept the default value displayed in brackets for each question, for example [sam-app]. Letters in UPPERCASE are defaults, for example, pressing enter to [y/N] will default in No.
    Missing authorization

    Accept all default by pressing enter and 
    Make sure to answer y to the question about missing authorization: HelloWorldFunction may not have authorization defined, Is this okay? [y/N]: y

    Run the following command in the same directory level where the template.yaml is located:

cd ~/PATH_TO/sam-app
sam deploy --guided

<!-- Test api and lambda by invoking the api -->
Look for the output api url on screen from the last command and run:

    curl -s (insert HelloWorldApi Value) : In this case the below

    curl -s https://j4qemx0eg5.execute-api.ca-central-1.amazonaws.com/Prod/hello/

The above command should return "hello my friend"


<!-- Summary so far-->
The guided deployment does few things for you. Let's take a quick look at what happened under the hood during the guided deployment to understand this process better.

Your codebase gets packaged as a zip file.
SAM creates an S3 bucket in your account, if it doesn't already exist.
Zip file is uploaded to the S3 bucket.
SAM creates the packaged template that references the location of the zip file on S3.
The packaged template is also uploaded to the S3 bucket.
SAM starts the deployment via CloudFormation ChangeSets.
The first time you do a guided deployment, a new file samconfig.toml is created in the root of your project with your specified deployment parameters. 
This file speeds up future sam deploy commands by using the same parameters without having you to enter them again.

<!-- clean up -->

cd ~/PATH_TO/sam-app
sam delete

    Answer 'yes' to the prompts as shown below
    
Are you sure you want to delete the stack sam-app in the region us-west-2 ? [y/N]: y
Are you sure you want to delete the folder sam-app in S3 which contains the artifacts? [y/N]: y